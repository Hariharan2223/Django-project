<!-- product_detail.html -->

<!-- Buy Now Button -->
<a href="" class="btn btn-warning " style="width: 128px;" data-toggle="modal" data-target="#buyNowModal">Buy Now</a>

<!-- Buy Now Modal -->
<div class="modal fade" id="buyNowModal" tabindex="-1" role="dialog" aria-labelledby="buyNowModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <form id="buyNowForm">
                <div class="modal-header">
                    <h5 class="modal-title" id="buyNowModalLabel">Buy Now</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    {% csrf_token %}
                    <input type="hidden" value="{{ products.id }}" id="pid" name="pid">
                    <div class="form-group">
                        <label for="address">Address</label>
                        <input type="text" class="form-control" id="address" name="address" required>
                    </div>
                    <div class="form-group">
                        <label for="phone">Phone</label>
                        <input type="text" class="form-control" id="phone" name="phone" required>
                    </div>
                    <div class="form-group">
                        <label for="txtqty">Quantity</label>
                        <input type="number" class="form-control" id="txtqty" name="product_qty" value="1" min="1" required>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                    <button type="submit" class="btn btn-primary">Place Order</button>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", function(event) {
    const buyNowForm = document.getElementById("buyNowForm");

    buyNowForm.addEventListener("submit", function(event) {
        event.preventDefault();
        const formData = new FormData(buyNowForm);
        fetch("{% url 'buynow' %}", {
            method: 'POST',
            body: formData,
            headers: {
                'X-CSRFToken': '{{ csrf_token }}',
                'X-Requested-With': 'XMLHttpRequest',
            },
        })
        .then(response => response.json())
        .then(data => {
            if (data.status === 'Success') {
                window.location.href = data.redirect_url;
            } else {
                alert(data.status);
            }
        });
    });
});
</script>
